# Execution Context

## 1. 실행 컨텍스트
코드를 작성하면 자바스크립트 엔진이 코드를 하나씩 파싱한다.

**실행 컨텍스트는 실행 가능한 코드 블럭이 실행되는 환경이다.** 환경에는 변수, this, 스코프, 함수 ... 등이 있다. 자바스크립트가 코드를 실행하려면 알고 있어야 하는 것들이 실행 환경이다.

자바스크립트는 실행 가능한 코드가 세 가지 있다.
* Global Code 전역 코드: 전역 영역에 존재하는 코드:
* Eval 코드: Eval 함수로 실행되는 코드-X
* 함수 코드: 함수 내에 존재하는 코드

자바스크립트는 진입 함수(e.g. Java나 C의 main)가 없다. 전역 쓴 코드는 실행된다. 전역에 쓰인 코드와 함수 내부에 쓰인 코드는 실행가능한 코드이다. 

Eval는 함수 내에 인자로 주어진 문자열을 실행시켜준다. 이는 보안상 문제가 될 수 있어 사용하지 않는다.

* 변수
  * 함수 내부에서만 접근할 수 있는 지역변수


이와 같이 실행에 필요한 정보를 자바스크립트 엔진은 실행 컨텍스트(Execution Context)이라는 객체 내에서 관리한다.

```javascript
var x = 'xxx';

function foo () {
  var y = 'yyy';

  function bar () {
    var z = 'zzz';
    console.log(x + y + z);
  }
  bar();
}
foo();
```

![](http://poiemaweb.com/img/ec_1.png)

1. 논리적 스택 구조를 가진 실행 컨텍스트 스택이 생성된다. 다른 언어들에서의 call 스택과 동일하다. 함수를 call하면 스택이 쌓인다. 스택은 후입선출(LIFO, Last In Fist Out)의 구조를 가지는 나열구조이다.

> 전역 실행 컨텍스트(global EC)가 끝나려면 브라우저를 닫아야 한다.

2. Global code(전역 코드)로 컨트롤이 들어가면 전역 실행 컨텍스트가 실행 컨텍스트 스택에 쌓인다. 전역 실행 컨텍스트는 애플리케이션이 종료될 때(웹 페이지에서 나가거나 브라우저를 닫을 때)까지 유지된다.

3. 함수를 호출하면 해당 함수의 실행 컨택스트가 생성되며 직전에 실행된 코드블럭의 실행 컨텍스트 위에 쌓인다.

4. 함수 실행이 끝나면 해당 함수의 실행 컨텍스트를 파기하고 직전의 실행 컨텍스트에 컨트롤을 반환한다.

<br>

## 2. 실행 컨텍스트 객체의 프로퍼티
실행 컨텍스트는 객체이며 아래 3가지 프로퍼티를 소유한다.

![](http://poiemaweb.com/img/excute_context_structure.png)

* Variable Object (VO)
* Scope chain
* thisValue

### 1) Variable Object (VO / 변수객체)

변수 객체는 변수 정보를 담고 있다.
* 변수
* 매개변수와 인수
* 함수 선언

위 예제에서 변수 객체에는 변수 x와 함수 foo가 담겨 있을 것이다.

```
전역 컨텍스트의 경우
Variable Object는 유일하며 최상위에 위치하고 모든 전역 변수, 전역 함수 등을 포함하는 **전역 객체(GO)를 가리킨다.** 전역 객체는 전역에 선언된 전역 변수와 전역 함수를 프로퍼티로 소유한다.
```

```
함수 컨텍스트의 경우
Variable Object는 **Activation Object(AO / 활성 객체)를 가리키며** 매개변수와 인수들의 정보를 배열의 형태로 담고 있는 객체인 arguments object가 추가된다.
```

왜 다른가?

전역 컨텍스트에는 매개변수와 인수, argument가 없다. 오로지 함수 컨텍스트에만 존재한다.

### 2) Scope Chain (SC)

리스트의 형태를 하고 있으며 스코프를 나타낸다. 
![](http://poiemaweb.com/img/ec-sc.png)

### 3) this value

일반 함수 내부에 기술된 this는 전역이다.

생성자 함수 내부에 기술된  this는 차후 그 생성자 함수가 생성할 객체이다. 그 외에는 전부 전역이다.

<br>

## 3. 실행 컨텍스트의 생성 과정

```javascript
var x = 'xxx';

function foo () {
  var y = 'yyy';

  function bar () {
    var z = 'zzz';
    console.log(x + y + z);
  }
  bar();
}

foo();
```

### 1) Global Code에의 진입

컨트롤이 실행 컨텍스트에 들어가기 전에 GO(프로퍼티로 DOM, BOM, Built-in object 등이 있다)가 생성된다. 전역 객체가 생성된 이후, Global Code로 컨트롤이 이동하면 새로운 전역 실행 컨텍스트가 this > SC > VO 순으로 스택에 쌓인다. 

#### **Scope Chain의 생성과 초기화**

새로운 실행 컨텍스트에 들어가게 되면 우선 Scope Chain의 생성과 초기화가 실행된다. Global Code로 컨트롤이 이동하면 Scope Chain는 전역 객체의 레퍼런스를 포함하는 리스트가 된다.

#### **Variable Instantiation(변수 객체화) 실행**
전역 실행 컨텍스트에서는 GO=AO이다. 
  * 함수 foo의 선언 처리
  실행 컨트롤이 들어가는 순간 코드가 실행되기도 전에 함수에 대한 레퍼런스를 일단 등록한다. (함수 호이스팅)

  * 변수 x의 선언처리
  실행 컨트롤이 들어가는 순간 코드가 실행되기도 전에 변수를 일단 등록한다. (변수 호이스팅)

  * this value 결정

<br>

### 2) Global code의 실행

지금까지는 코드를 실행하기 위한 환경을 갖추기 위한 사전 준비였다. 코드 실행은 지금부터 시작이다.

```javascript
var x = 'xxx';

function foo () {
  var y = 'yyy';

  function bar () {
    var z = 'zzz';
    console.log(x + y + z);
  }
  bar();
}

foo();
```

전역변수 x에 문자열 xxx할당과 함수 foo의 호출이 실행된다.

### 3) foo function code의 실행

